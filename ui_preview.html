<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
            background: #222;
            color: #fff;
        }

        button {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            font-size: 18px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        input {
            padding: 10px;
            font-size: 16px;
            width: 60px;
            text-align: center;
        }

        .control-group {
            margin: 20px 0;
            padding: 15px;
            background: #333;
            border-radius: 10px;
        }

        .rainbow {
            background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet);
            color: black;
        }

        .red {
            background-color: #ff4444;
            color: white;
        }

        .green {
            background-color: #44ff44;
            color: black;
        }

        .blue {
            background-color: #4444ff;
            color: white;
        }

        .cool {
            background: linear-gradient(45deg, #ff00cc, #3333ff);
            color: white;
        }

        .fire {
            background: linear-gradient(to right, #ff0000, #ffff00);
            color: black;
        }

        .special {
            background: linear-gradient(to right, #00ffff, #ff00ff);
            color: black;
        }

        .off {
            background-color: #555;
            color: white;
        }

        /* Tab styles */
        .tabs {
            display: flex;
            margin: 20px 0;
            border-bottom: 2px solid #444;
        }

        .tab {
            flex: 1;
            padding: 15px;
            background: #333;
            border: none;
            color: #aaa;
            cursor: pointer;
            font-size: 16px;
        }

        .tab.active {
            background: #444;
            color: #fff;
            border-bottom: 3px solid #00ffff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .footer {
            margin-top: 20px;
            font-size: 12px;
            color: #666;
        }
    </style>
    <script>
        function setMode(m) {
            console.log('setMode: ' + m);
        }
        function showTab(tabName) {
            var tabs = document.getElementsByClassName('tab-content');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            var tabButtons = document.getElementsByClassName('tab');
            for (var i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
    </script>
</head>

<body>
    <h1>LED Controller</h1>

    <div style="margin: 20px 0; padding: 15px; background: #333; border-radius: 8px;">
        <label style="color: #fff; font-size: 18px; margin-right: 10px;">Layout:</label>
        <select
            style="padding: 8px; font-size: 16px; background: #444; color: #fff; border: 1px solid #666; border-radius: 4px;">
            <option value="0">Nx8x32 Multi-Panel (256 LEDs)</option>
        </select>
        <span style="color: #aaa; margin-left: 15px;">Active LEDs: 256</span>
    </div>

    <div class="control-group">
        <label>Panel Configuration (8x32 panels):</label>
        <form action="/setPanels" method="get" style="display:inline;">
            <label>Rows:</label>
            <input type="number" name="r" id="r" min="1" max="16" value="1" style="width: 50px;">
            <label>Cols:</label>
            <input type="number" name="c" id="c" min="1" max="16" value="1" style="width: 50px;">
            <button type="button" style="display:inline; width:auto; padding: 10px;">Set</button>
        </form>
        <br><small style="color:#aaa">Grid Size: (Cols*32) x (Rows*8)</small>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="showTab('tab-patterns')">Patterns</button>
        <button class="tab" onclick="showTab('tab-text')">Scrolling Text</button>
    </div>

    <!-- Patterns Tab -->
    <div id="tab-patterns" class="tab-content active">
        <!-- Dynamic Menu Container -->
        <div id="patterns-container">
            <p style="color: #aaa; text-align: center;">Loading patterns...</p>
        </div>
    </div>

    <script>
        // Fetch and render patterns
        fetch('/api/patterns')
            .then(response => response.json())
            .then(patterns => {
                const container = document.getElementById('patterns-container');
                container.innerHTML = ''; // Clear loading message

                // Group by category
                const categories = {};
                patterns.forEach(p => {
                    if (!categories[p.category]) categories[p.category] = [];
                    categories[p.category].push(p);
                });

                // Render categories
                for (const [category, items] of Object.entries(categories)) {
                    const groupDiv = document.createElement('div');
                    groupDiv.className = 'control-group';

                    const title = document.createElement('h3');
                    title.textContent = category;
                    groupDiv.appendChild(title);

                    items.forEach(p => {
                        const btn = document.createElement('button');
                        btn.textContent = p.name;
                        btn.onclick = () => setMode(p.id);

                        // Assign random color class for variety
                        const colors = ['cool', 'warm', 'special', 'fire', 'green', 'blue', 'rainbow', 'red'];
                        const colorClass = colors[p.id % colors.length];
                        btn.className = colorClass;

                        groupDiv.appendChild(btn);
                    });

                    container.appendChild(groupDiv);
                }
            })
            .catch(err => {
                console.error('Error loading patterns:', err);
                // Fallback for preview file if API not available
                document.getElementById('patterns-container').innerHTML = '<p style="color:red">Error loading patterns. Ensure device is connected.</p>';
            });
    </script>

    <!-- Scrolling Text Tab -->
    <div id="tab-text" class="tab-content">
        <h2>Scrolling Text</h2>
        <div class="control-group">
            <label>Enter text to scroll:</label>
            <div style="margin-top: 10px;">
                <input type="text" id="textInput" value="HELLO WORLD"
                    style="width: 80%; padding: 10px; font-size: 16px;" maxlength="100">
                <button onclick="updateText()" style="width: 18%; padding: 10px;">Set</button>
            </div>

            <div style="margin-top: 15px;">
                <label>Scroll Speed: <span id="speedDisplay">20</span></label><br>
                <input type="range" id="speedSlider" min="1" max="100" value="20" style="width: 80%;"
                    oninput="document.getElementById('speedDisplay').textContent = this.value">
                <br>
                <small style="color: #888;">1 = Slow, 100 = Fast</small>
            </div>
        </div>
        <p style="color: #aaa; font-size: 14px;">Supports: A-Z, 0-9, space, !, ., -</p>
    </div>

    <div class="footer">
        Build: Dec 2 2025 21:11:00
    </div>
</body>

</html>